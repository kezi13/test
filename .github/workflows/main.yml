on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deploy to'
        required: true
        default: 'stage'
        type: choice
        options:
        - stage
        - production

jobs:
  deploy-to-stage:
    if: ${{ inputs.environment }} == 'stage'
    runs-on: ubuntu-latest
    environment: stage
    steps:
      - name: Create SSH key
        run: |
          install -m 600 -D /dev/null ~/.ssh/id_rsa
          echo "${{ secrets.PRIVATE_KEY }}" > ~/.ssh/id_rsa
          echo "${{ secrets.PUBLIC_KEY }}" > ~/.ssh/id_rsa.pub
          echo "${{ secrets.SSH_CONFIG }}" > ~/.ssh/config
          echo "${{ secrets.KNOW_HOSTS }}" > ~/.ssh/known_hosts
      - name: Deploy To STAGE
      - shell: bash
        run: ssh stage 'sh /var/www/vhosts/stage.vivelacar.com/deployer/deploy_env'
